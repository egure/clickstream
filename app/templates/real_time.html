<script src ="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>


<button id="auth-button" hidden>Authorize</button>

<h1>Results</h1>

<div id="events"></div>

<h1>The tests</h1>

<pre id="pre"></pre>

<textarea cols="80" rows="20" id="query-output"></textarea>

<ul id="list"></ul>

<script>

  // Replace with your client ID from the developer console.
  //var CLIENT_ID = "455316581334-l0sm1ehg8ebmfk35jvi7psi0v69t7ujd.apps.googleusercontent.com	";
  var CLIENT_ID = "455316581334-l0sm1ehg8ebmfk35jvi7psi0v69t7ujd.apps.googleusercontent.com";	

  // Set authorized scope.
  var SCOPES = ['https://www.googleapis.com/auth/analytics.readonly'];

  var hello;

  function authorize(event) {
    // Handles the authorization flow.
    // `immediate` should be false when invoked from the button click.
    var useImmdiate = event ? false : true;
    var authData = {
      client_id: CLIENT_ID,
      scope: SCOPES,
      immediate: useImmdiate
    };

    gapi.auth.authorize(authData, function(response) {
      var authButton = document.getElementById('auth-button');
      if (response.error) {
        authButton.hidden = false;
      }
      else {
        authButton.hidden = true;
        queryAccounts();
      }
    });
  }


function queryAccounts() {
  // Load the Google Analytics client library.
  gapi.client.load('analytics', 'v3').then(function() {

    // Get a list of all Google Analytics accounts for this user
    gapi.client.analytics.management.accounts.list().then(handleAccounts);
  });
}


function handleAccounts(response, hello) {
  // Handles the response from the accounts list method.
  if (response.result.items && response.result.items.length) {
    // Get the first Google Analytics account.
    var firstAccountId = response.result.items[0].id;

    // Query for properties.
    queryProperties(firstAccountId);
  } else {
    console.log('No accounts found for this user.');
  }
}


function queryProperties(accountId) {
  // Get a list of all the properties for the account.
  gapi.client.analytics.management.webproperties.list(
      {'accountId': accountId})
    .then(handleProperties)
    .then(null, function(err) {
      // Log any errors.
      console.log(err);
  });
}


function handleProperties(response, hello) {
  // Handles the response from the webproperties list method.
  if (response.result.items && response.result.items.length) {

    // Get the first Google Analytics account
    var firstAccountId = response.result.items[0].accountId;

    // Get the first property ID
    var firstPropertyId = response.result.items[0].id;

    // Query for Views (Profiles).
    queryProfiles(firstAccountId, firstPropertyId);
  } else {
    console.log('No properties found for this user.');
  }
}


function queryProfiles(accountId, propertyId) {
  // Get a list of all Views (Profiles) for the first property
  // of the first Account.
  gapi.client.analytics.management.profiles.list({
      'accountId': accountId,
      'webPropertyId': propertyId
  })
  .then(handleProfiles)
  .then(null, function(err) {
      // Log any errors.
      console.log(err);
  });
}


function handleProfiles(response) {
  // Handles the response from the profiles list method.
  if (response.result.items && response.result.items.length) {
    // Get the first View (Profile) ID.
    var firstProfileId = response.result.items[0].id;

    // Query the Core Reporting API.
    queryCoreReportingApi(firstProfileId);
  } else {
    console.log('No views (profiles) found for this user.');
  }
}


function queryCoreReportingApi(profileId, hello) {
  var profile_id = "159135697";
  gapi.client.analytics.data.realtime.get({
      'ids':'ga:' + profile_id,
      'metrics':'rt:totalEvents',
      'dimensions':'rt:eventAction,rt:eventLabel,rt:eventCategory', 
      'max_results':'25'})
  .then(function(response) {  	
    var formattedJson = JSON.stringify(response.result.rows[0][1], null, );
    var dbObject = JSON.stringify(response.result, null, 1);
    document.getElementById('query-output').value = formattedJson;
    var hello = "3";
  // Initialize Firebase
    (function(){
  var config = {
    apiKey: "AIzaSyDUkZoY9nE97BRl1eGDWGuTdfnJX9X960c",
    authDomain: "neem-fs.firebaseapp.com",
    databaseURL: "https://neem-fs.firebaseio.com",
    projectId: "neem-fs",
    storageBucket: "neem-fs.appspot.com",
    messagingSenderId: "455316581334"
  };
  firebase.initializeApp(config);
  var database = firebase.database();
  var ref = database.ref('object');
  console.log(dbObject); 
  ref.push(dbObject);
}())
  }).then(null, function(err) {
      console.log(err);
  });
}
  // Add an event listener to the 'auth-button'.
  document.getElementById('auth-button').addEventListener('click', authorize);
</script>

<script src="https://apis.google.com/js/client.js?onload=authorize"></script>

<br>

<script src="https://apis.google.com/js/client.js?onload=authorize"></script>

{{brand}}

